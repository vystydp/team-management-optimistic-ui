# Security Guidelines

## GitHub OAuth Security Implementation

This application implements GitHub OAuth authentication following security best practices.

### ✅ Security Measures Implemented

#### 1. Secret Management
- **`GITHUB_CLIENT_SECRET`** is stored only in backend environment variables
- Never exposed to frontend or committed to repository
- Backend `.env` files are gitignored
- Production secrets stored in secure environment (Kubernetes Secrets, Vercel env vars)

#### 2. OAuth Flow Security
- **Authorization Code Flow** implemented server-side
- Token exchange happens exclusively on backend
- Frontend never constructs OAuth requests or handles secrets
- CSRF protection via state parameter (implemented)
- Redirect URI validation

#### 3. Minimal Scopes
- Only requests `user:email` scope
- No unnecessary repository or organization access
- Follows principle of least privilege

#### 4. Token Handling
- JWT tokens generated by backend
- Short-lived tokens (7 days expiration)
- Tokens include user ID and minimal claims
- Backend validates tokens on protected routes

### ⚠️ Known Security Considerations

#### localStorage Usage
**Current Implementation**: JWT tokens stored in `localStorage`

**Risk**: Vulnerable to XSS attacks if application has XSS vulnerabilities

**Mitigation Options** (for future enhancement):
1. Move to httpOnly cookies with SameSite=Strict
2. Implement Content Security Policy (CSP)
3. Use secure session storage
4. Add XSS protection headers (already implemented in Vercel config)

**Why localStorage for now**:
- Simpler CORS handling for development
- Frontend is Vite SPA with no sensitive data in DOM
- XSS protection headers configured
- Trade-off accepted for MVP development

#### Session Security
- Session secrets should be rotated in production
- Use strong random values for `JWT_SECRET` and `SESSION_SECRET`
- Never use default/example secrets in production

## Production Deployment Checklist

### Before deploying to production:

1. **Rotate Secrets**
   ```bash
   # Generate new secrets
   node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
   ```

2. **Configure Environment Variables**
   - Set `GITHUB_CLIENT_ID` and `GITHUB_CLIENT_SECRET` in Vercel/K8s secrets
   - Set strong `JWT_SECRET` (64+ chars random)
   - Set strong `SESSION_SECRET` (64+ chars random)
   - Set `NODE_ENV=production`
   - Set correct `FRONTEND_URL` and `GITHUB_CALLBACK_URL`

3. **Update GitHub OAuth App**
   - Create separate production OAuth app
   - Set production callback URL: `https://your-backend.com/auth/callback`
   - Set homepage URL: `https://your-app.com`
   - Review and limit scopes

4. **Enable Security Headers**
   - CSP headers (configured in vercel.json)
   - HSTS for HTTPS enforcement
   - X-Frame-Options, X-Content-Type-Options (already configured)

5. **Token Expiration**
   - Configure appropriate JWT expiration for your use case
   - Implement token refresh mechanism if needed
   - Handle 401 errors gracefully with re-authentication

## Monitoring & Incident Response

### Token Revocation
If secrets are compromised:
1. Immediately regenerate `GITHUB_CLIENT_SECRET` in GitHub settings
2. Update backend environment variables
3. Restart backend services
4. Force all users to re-authenticate

### Access Review
- Regularly review OAuth app access in GitHub organization settings
- Monitor for unauthorized access patterns
- Audit user sessions and tokens

## Development Best Practices

### Never Commit Secrets
- Always use `.env` files (gitignored)
- Use `.env.example` for documentation only
- Validate no secrets in `git log` before pushing

### Local Development
```bash
# backend/.env (never commit)
GITHUB_CLIENT_ID=your_local_dev_client_id
GITHUB_CLIENT_SECRET=your_local_dev_client_secret
JWT_SECRET=$(openssl rand -hex 32)
SESSION_SECRET=$(openssl rand -hex 32)
```

### Code Review Checklist
- [ ] No hardcoded secrets or tokens
- [ ] No console.log of sensitive data
- [ ] Input validation on all endpoints
- [ ] Authentication middleware on protected routes
- [ ] Error messages don't leak sensitive info

## Reporting Security Issues

If you discover a security vulnerability:
1. **Do not** open a public issue
2. Email security concerns to repository maintainer
3. Include steps to reproduce
4. Allow time for fix before public disclosure

## References

- [GitHub OAuth Best Practices](https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/best-practices-for-creating-an-oauth-app)
- [OAuth 2.0 Security Best Practices](https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics)
- [OWASP Authentication Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Authentication_Cheat_Sheet.html)
